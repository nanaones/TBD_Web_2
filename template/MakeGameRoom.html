{% extends 'original.html' %}
{% load static %}
{% block content %}

  <!-- Header -->
  <header class="masthead">
    <div class="container">
    </div>
  </header>
<!-- end -->

  
  <!-- Contact -->
  <section id="contact">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 text-center">
            <h2 class="section-heading text-uppercase">Make Room</h2>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-12">
              <p> <input class="form-amount" id="amount-loop" style="width:1110px" type="int" placeholder="prize_per_game / default is 10 " required="required" data-validation-required-message="Please enter value.">
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group">
                      <textarea id="score-data" rows="20" cols = "50" placeholder="Request Json"  data-validation-required-message="Please enter a message."></textarea>
                      <p class="help-block text-danger"></p>
                    </div>
                  </div>

                  <div class="col-md-6">
                      <div class="form-group">
                        <textarea id="score-response" rows="20" cols = "50" placeholder="Response Json"  data-validation-required-message="Please enter a message."></textarea>
                        <p class="help-block text-danger"></p>
                      </div>
                    </div>

                  <div class="clearfix"></div>
                  <div class="col-lg-12 text-center">
                    <div id="success"></div>
                    <button id="request-address" class="btn btn-primary btn-xl text-uppercase" >Load Wallet</button>
                    <button id="request-score" class="btn btn-primary btn-xl text-uppercase" >Make   it !!!!!!!!!!</button>
                  </div>
                  
                </div>
          </div>
        </div>
      </div>
    </section>


  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <span class="copyright">Copyright &copy; Your Website 2019</span>
        </div>
        <div class="col-md-4">
          <ul class="list-inline social-buttons">
            <li class="list-inline-item">
              <a href="#">
                <i class="fab fa-twitter"></i>
              </a>
            </li>
            <li class="list-inline-item">
              <a href="#">
                <i class="fab fa-facebook-f"></i>
              </a>
            </li>
            <li class="list-inline-item">
              <a href="#">
                <i class="fab fa-linkedin-in"></i>
              </a>
            </li>
          </ul>
        </div>
        <div class="col-md-4">
          <ul class="list-inline quicklinks">
            <li class="list-inline-item">
              <a href="#">Privacy Policy</a>
            </li>
            <li class="list-inline-item">
              <a href="#">Terms of Use</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </footer>


  <!-- JS code -->
  <script src="http://cdn.jsdelivr.net/gh/icon-project/icon-sdk-js@latest/build/icon-sdk-js.web.min.js"></script>
  <script>
      var IconService = window['icon-sdk-js']
      var HttpProvider = IconService.HttpProvider
      var IconServices = new IconService(new HttpProvider('https://bicon.net.solidwallet.io/api/v3'))
      var IconWallet = IconServices.IconWallet
      var IconAmount = IconServices.IconAmount
      var IconConverter = IconService.IconConverter
      var IconBuilder = IconService.IconBuilder


      var amount_loop = document.getElementById("amount-loop")
      var token_balance = document.getElementById("token-balance")

      var requestAddress = document.getElementById("request-address")
      var responseAddress = document.getElementById("response-address")

      var requestScore = document.getElementById("request-score")
      var requestScoreForm = document.getElementById("request-score-form")
      var responseScore = document.getElementById("response-score")


      var sendAddress = document.getElementById("send-address")
      var sendAmount = document.getElementById("send-amount")

      var scoreData = document.getElementById("score-data")
      var signingData = document.getElementById("signing-data")

      var jsonRpc2 = document.getElementById("json-rpc-2")
      var tx_result = document.getElementById("tx-result")
      var scoreresponse = document.getElementById("score-response")

      window.addEventListener("ICONEX_RELAY_RESPONSE", eventHandler, false);

      function eventHandler(event) {
          var type = event.detail.type
          var payload = event.detail.payload
          switch (type) {
              case "RESPONSE_ADDRESS":
                  fromAddress = payload
                  break
              case "RESPONSE_JSON-RPC":
                  setTimeout(function Tx_result(hash){
                    IconServices.getTransactionResult(payload.result).execute().then(
                      function(result) {
                        JSON.stringify(result)
                        scoreresponse.innerHTML = JSON.stringify(result);
                    }, function(error){
                      confirm.log(error)
                    });}, 4000)
                  break
              case "CANCEL_JSON-RPC":
                  responseScore.value = null;
                  break
              case "RESPONSE_SIGNING":
                  signingData.value = null
                  responseSigning.innerHTML = "> Signature : " + JSON.stringify(payload);
                  break
              case "CANCEL_SIGNING":
                  signingData.value = null
                  responseSigning.value = "> Signature : ";
                  break

              default:
          }
      }


      requestAddress.onclick = function () {
          window.dispatchEvent(new CustomEvent('ICONEX_RELAY_REQUEST', {
              detail: {
                  type: 'REQUEST_ADDRESS'
              }
          }))
      }

      requestScore.onclick = function () {
        var callTransactionBuilder = new IconBuilder.CallTransactionBuilder;
        var callTransactionData = callTransactionBuilder
                      .from(fromAddress)
                      .to("cx89245b4a663f2062a9fe52a219c44c281e1d6c36")
                      .nid(IconConverter.toBigNumber(3))
                      .timestamp((new Date()).getTime() * 1000)
                      .stepLimit(IconConverter.toBigNumber(10000000))
                      .version(IconConverter.toBigNumber(3))
                      .method('createRoom')
                      .params({"_prizePerGame":amount_loop.value})
                      .build()
                  scoreData.value = JSON.stringify({
                      "jsonrpc": "2.0",
                      "method": "icx_sendTransaction",
                      "params": IconConverter.toRawTransaction(callTransactionData),
                      "id": 8015
                      })

          var parsed = JSON.parse(scoreData.value)
          if (parsed.method === "icx_sendTransaction" && !fromAddress) {
              alert('Select the ICX Address')
              return
          }

          window.dispatchEvent(new CustomEvent('ICONEX_RELAY_REQUEST', {
              detail: {
                  type: 'REQUEST_JSON-RPC',
                  payload: parsed
              }
          }))
      }

  </script>
<!--in data-->

{% endblock %}

