{% extends 'original.html' %}
{% block content %}

  <!-- Header -->
  <header class="masthead">
    <div class="container">
    </div>
  </header>
<!-- end -->

  <!-- Contact -->
  <section id="contact">
    <div class="container">
      <div class="row">
        <div class="col-lg-12 text-center">
        </div>
      </div>
      <div class="row">
        <div class="col-lg-12">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <div class="col-lg-12 text-center">


<h2 class="section-heading text-uppercase">Mint Token</h2>

<form id="request-score-form">
    <p>
   </p>
</form>

<input class="form-amount" id="amount-loop" type="int" placeholder="Token 구매양" required="required" data-validation-required-message="Please enter value.">
<p>Param Data: <br><textarea id="score-data" rows="10"></textarea></p>
<button id="request-address" class="btn btn-primary btn-xl text-uppercase"> Load Your Wallet</button>
<button id="request-score" class="btn btn-primary btn-xl text-uppercase" >Mint it!</button>


          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <span class="copyright">Copyright &copy; Your Website 2019</span>
        </div>
        <div class="col-md-4">
          <ul class="list-inline social-buttons">
            <li class="list-inline-item">
              <a href="#">
                <i class="fab fa-twitter"></i>
              </a>
            </li>
            <li class="list-inline-item">
              <a href="#">
                <i class="fab fa-facebook-f"></i>
              </a>
            </li>
            <li class="list-inline-item">
              <a href="#">
                <i class="fab fa-linkedin-in"></i>
              </a>
            </li>
          </ul>
        </div>
        <div class="col-md-4">
          <ul class="list-inline quicklinks">
            <li class="list-inline-item">
              <a href="#">Privacy Policy</a>
            </li>
            <li class="list-inline-item">
              <a href="#">Terms of Use</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </footer>


  <!-- JS code -->
  <script src="http://cdn.jsdelivr.net/gh/icon-project/icon-sdk-js@latest/build/icon-sdk-js.web.min.js"></script>
  <script>
      var iconService = window['icon-sdk-js']
      var provider = new iconService.HttpProvider('https://bicon.net.solidwallet.io/api/v3')
      var IconWallet = iconService.IconWallet
      var IconAmount = iconService.IconAmount
      var IconConverter = iconService.IconConverter
      var IconBuilder = iconService.IconBuilder
      



      var amount_loop = document.getElementById("amount-loop")
      var token_balance = document.getElementById("token-balance")

      var requestAddress = document.getElementById("request-address")
      var responseAddress = document.getElementById("response-address")

      var requestScore = document.getElementById("request-score")
      var requestScoreForm = document.getElementById("request-score-form")
      var responseScore = document.getElementById("response-score")


      var sendAddress = document.getElementById("send-address")
      var sendAmount = document.getElementById("send-amount")
      var scoreData = document.getElementById("score-data")
      var signingData = document.getElementById("signing-data")

      var jsonRpc2 = document.getElementById("json-rpc-2")

      window.addEventListener("ICONEX_RELAY_RESPONSE", eventHandler, false);

      function eventHandler(event) {
          var type = event.detail.type
          var payload = event.detail.payload
          switch (type) {
              case "RESPONSE_ADDRESS":
                  fromAddress = payload
                  break

              case "RESPONSE_JSON-RPC":
                  responseScore.value = JSON.stringify(payload);
                  break
              case "CANCEL_JSON-RPC":
                  responseScore.value = null;
                  break
              case "RESPONSE_SIGNING":
                  signingData.value = null
                  responseSigning.innerHTML = "> Signature : " + JSON.stringify(payload);
                  break
              case "CANCEL_SIGNING":
                  signingData.value = null
                  responseSigning.value = "> Signature : ";
                  break

              default:
          }
      }


      requestAddress.onclick = function () {
          window.dispatchEvent(new CustomEvent('ICONEX_RELAY_REQUEST', {
              detail: {
                  type: 'REQUEST_ADDRESS'
              }
          }))
      }


      requestScore.onclick = function () {
        var callTransactionBuilder = new IconBuilder.CallTransactionBuilder;
        var callTransactionData = callTransactionBuilder
                      .from(fromAddress)
                      .to("cx89245b4a663f2062a9fe52a219c44c281e1d6c36")
                      .nid(IconConverter.toBigNumber(3))
                      .timestamp((new Date()).getTime() * 1000)
                      .stepLimit(IconConverter.toBigNumber(10000000))
                      .version(IconConverter.toBigNumber(3))
                      .value(IconConverter.toBigNumber(amount_loop.value))
                      .method('mint_chips')
                      .params('')
                      .build()
                  scoreData.value = JSON.stringify({
                      "jsonrpc": "2.0",
                      "method": "icx_sendTransaction",
                      "params": IconConverter.toRawTransaction(callTransactionData),
                      "id": 8015                  })


          var parsed = JSON.parse(scoreData.value)
          if (parsed.method === "icx_sendTransaction" && !fromAddress) {
              alert('Select the ICX Address')
              return
          }

          window.dispatchEvent(new CustomEvent('ICONEX_RELAY_REQUEST', {
              detail: {
                  type: 'REQUEST_JSON-RPC',
                  payload: parsed
              }
          }))
      }

  </script>
<!--in data-->

{% endblock %}

